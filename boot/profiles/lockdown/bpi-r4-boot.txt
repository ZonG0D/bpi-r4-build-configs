setenv bootdelay 0
setenv boot_targets mmc0
setenv loadaddr 0x46000000
setenv kernel_addr_r 0x44000000
setenv fdt_addr_r 0x48000000

setenv lockdown_boot 'if fatload mmc 0:5 ${kernel_addr_r} Image; then if fatload mmc 0:5 ${fdt_addr_r} mediatek/mt7988a-bananapi-bpi-r4.dtb; then booti ${kernel_addr_r} - ${fdt_addr_r}; fi; fi'

setenv lockdown_unlock 'if test -n "${lockdown_unlock_cmd}"; then if run lockdown_unlock_cmd; then echo [lockdown] hardware unlock command succeeded; if test -n "${lockdown_unlock_payload}"; then run lockdown_unlock_payload; elif fatload mmc 0:5 ${loadaddr} unlock.scr; then echo [lockdown] executing unlock.scr; source ${loadaddr}; fi; fi; fi'

setenv lockdown_bootstrap '
  run lockdown_unlock;
  if fatload mmc 0:5 ${loadaddr} boot.scr; then
    echo [lockdown] executing boot.scr;
    source ${loadaddr};
  fi;
  echo [lockdown] attempting direct MMC boot;
  run lockdown_boot;
  echo [lockdown] boot failed; resetting.;
  reset;
'

run lockdown_bootstrap
