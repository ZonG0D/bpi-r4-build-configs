setenv bootdelay -2
setenv bootmenu_delay -1
setenv bootmenu_title 'BPI-R4 boot menu'
setenv bootmenu_ansi n
setenv boot_targets mmc0
setenv loadaddr 0x46000000
setenv kernel_addr_r 0x44000000
setenv fdt_addr_r 0x48000000

if test -z "${env_inited}"; then
  echo [env] initializing persistent environment on FAT
  setenv env_inited 1
  if test -z "${ethaddr}"; then
    echo [warn] ethaddr is unset; configure a unique MAC with 'setenv ethaddr'
  fi
  saveenv
fi

setenv try_boot '
  if env exists distro_bootcmd; then
    echo [boot] distro_bootcmd; run distro_bootcmd; exit;
  fi;
  echo [boot] bootflow scan -lb;
  bootflow scan -lb;
  if test $? -eq 0; then exit; fi;
  echo [boot] manual mmc0:5 Image + DTB;
  if fatload mmc 0:5 ${kernel_addr_r} Image; then
    if fatload mmc 0:5 ${fdt_addr_r} mediatek/mt7988a-bananapi-bpi-r4.dtb; then
      booti ${kernel_addr_r} - ${fdt_addr_r}; exit;
    fi;
  fi;
  echo [boot] no bootable payload on mmc0:5;
'

setenv bootmenu_0 'Continue distro boot=run try_boot'
setenv bootmenu_1 'U-Boot shell=setenv bootdelay -2; echo Entering shell...'
setenv bootmenu_2 'Reboot=reset'

bootmenu
